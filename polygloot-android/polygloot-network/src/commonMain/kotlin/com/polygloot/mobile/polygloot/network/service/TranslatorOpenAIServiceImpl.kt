package com.polygloot.mobile.polygloot.network.service

import com.polygloot.mobile.polygloot.network.NetworkClient
import com.polygloot.mobile.polygloot.network.dto.ChatCompletionDTO
import com.polygloot.mobile.polygloot.network.dto.ChatCompletionRequestDTO
import com.polygloot.mobile.polygloot.network.dto.InputAudio
import com.polygloot.mobile.polygloot.network.dto.MessageInputAdvance
import com.polygloot.mobile.polygloot.network.dto.MessageInputSimple
import com.polygloot.mobile.polygloot.network.dto.SpeechToTextDTO
import com.polygloot.mobile.polygloot.network.dto.UserContent
import io.ktor.client.call.body
import io.ktor.client.statement.HttpResponse
import io.ktor.http.isSuccess
import java.io.File

class TranslatorOpenAIServiceImpl(private val networkClient: NetworkClient) :
    TranslatorOpenAIService {

    override suspend fun detectLanguage(inputText: String): TranslatorNetworkResponse<String, String> =
        networkClient.detectLanguage(inputText).handleResponse()

    override suspend fun translateText(
        inputText: String,
        sourceLanguage: String,
        targetLanguage: String
    ): TranslatorNetworkResponse<String, String> =
        networkClient.translateText(inputText, sourceLanguage, targetLanguage).handleResponse()

    override suspend fun translateTextAndTTS(
        inputText: String,
        sourceLanguage: String,
        targetLanguage: String
    ): TranslatorNetworkResponse<ChatCompletionDTO, String> =
        networkClient.translateTextAndTextToSpeech(inputText, sourceLanguage, targetLanguage).handleResponse()

    override suspend fun translateAudioAndTTS(
        base64audio: String,
        sourceLanguage: String,
        targetLanguage: String
    ): TranslatorNetworkResponse<ChatCompletionDTO, String> {
        /*
        val testAudio = "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"
        Log.e("Audio", "TEST: $testAudio")
        val chunkSize = 1000 // Adjust the chunk size as needed
        val base64audioChunks = "$base64audio==".chunked(chunkSize)
        base64audioChunks.forEachIndexed { index, chunk ->
            Log.e("Audio", "RECORDED PART $index: $chunk")
        }
        */
        val bodyRequestDTO = ChatCompletionRequestDTO(
            messages = listOf(
                MessageInputSimple(
                    role = "system",
                    content = "You are a helpful translator, you are given an input text in $sourceLanguage, translate it to $targetLanguage"
                ),
                MessageInputAdvance(
                    role = "user",
                    content = listOf(
                        UserContent("input_audio", InputAudio(data = base64audio, format = "mp3"))
                    )
                )
            )
        )
        return networkClient.translateAudioAndTextToSpeech(bodyRequestDTO).handleResponse()
    }

    override suspend fun detectLanguageAndTranslate(
        inputText: String,
        targetLanguage: String
    ): TranslatorNetworkResponse<String, String> =
        networkClient.detectLanguageAndTranslate(inputText, targetLanguage).handleResponse()

    override suspend fun textToSpeech(inputText: String): TranslatorNetworkResponse<File, String> =
        networkClient.textToSpeech(inputText).handleResponse()

    override suspend fun speechToText(filePath: String): TranslatorNetworkResponse<SpeechToTextDTO, String> =
        networkClient.speechToText(filePath).handleResponse()

    private suspend inline fun <reified T : Any> HttpResponse.handleResponse(customBody: T? = null): TranslatorNetworkResponse<T, String> {
        return if (this.status.isSuccess()) {
            TranslatorNetworkResponse.Success(customBody ?: this.body())
        } else {
            this.handleErrorResponse()
        }
    }
}